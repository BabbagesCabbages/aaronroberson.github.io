<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Day 9 - User Authentication</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Personal blog and speaking schedule of Aaron Roberson, a JavaScript and AngularJS enthusiast specializing in the development of rich internet applications with a thick front-end.">
    <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
    <link rel="canonical" href="http://pixelpolished.com/geekwise/day-9-user-authentication/">

    <!-- Custom CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/styles/aaronroberson.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


    <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Pixel Polished</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                
                    
                        
                        <li><a href="/about/">About</a></li>
                        
                    
                
                    
                        
                        <li><a href="/contact/">Contact</a></li>
                        
                    
                
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                        
                    
                
                    
                
                    
                
                    
                        
                    
                
                    
                
                    
                        
                        <li><a href="/speaking/">Speaking</a></li>
                        
                    
                
            </ul>
            <ul class="nav navbar-right navbar-nav">
                <li class="dropdown">
                    <a href="/geekwise/" class="dropdown-toggle" data-toggle="dropdown">Geekwise <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/">Course overview</a></li>
        
    
        
    
        
    

    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-1-javascript-objects/">Day 1 - JavaScript Objects</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-2-intro-to-angularjs/">Day 2 - Intro to AngularJS</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-3-get-your-swag-on/">Day 3 - Get your swagger on!</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-4-product-listing/">Day 4 - Product Listing</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-5-getting-mean/">Day 5 - Getting MEAN</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-6-directives/">Day 6 - Directives</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-7-shopping-cart-part-1/">Day 7 - Shopping Cart Part 1</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-8-shopping-cart-part-2/">Day 8 - Shopping Cart Part 2</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-9-user-authentication/">Day 9 - User Authentication</a></li>
        
    
        
    
        
    
        
    
        
    
        
    

                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

    <div class="container">

        <header class="masthead">
    <div class="container">
        <div class="row">
            <div class="col col-sm-12 col-md-8">
                <div class="social">
                    <div class="rounded center icon-share"></div>
                    <div class="share-container rounded">
                        <a class="share-btn tl icon-google-plus" href='https://plus.google.com/+AaronRoberson'></a>
                        <a class="share-btn tr icon-twitter" href='https://twitter.com/aaronroberson'></a>
                        <a class="share-btn bl icon-github" href='https://github.com/aaronroberson'></a>
                        <a class="share-btn br icon-linkedin" href='https://linkedin.com/in/aaronrobes'></a>
                    </div>
                </div>â€‹
                <h1><a href="/">Aaron Roberson</a>
                    <p class="lead text-muted">Rich internet applications with a thick front-end</p></h1>
            </div>
            <div class="col col-md-4 hidden-sm hidden-xs text-right">
                <a href="http://devfest.gdgfresno.com" target="_blank">
                    <img src="/assets/images/speaking/gdg-fresno-speaker.png" style="margin-top: 20px; width: 300px" alt="GDG DevFest Fresno Speaker">
                </a>
            </div>
        </div>
    </div>
</header>



        <div class="row">
            <div class="col col-sm-9">
    
    <section class="post">
        <h1>Day 9 - User registration and login</h1>

<p>In tonight's class you will:</p>

<ul>
    <li>Create an authentication service</li>
    <li>Add an app controller</li>
    <li>Add Angular Messages for form validation</li>
    <li>Add Angular Cookies for user session management</li>
    <li>Adding user registration:
        <ul>
            <li>Create a sign up controller</li>
            <li>Update the sign up view</li>
            <li>Add sign up API rest point</li>
            <li>Add a sign up state to client-side routes</li>
        </ul>
    </li>
    <li>Adding user login:
        <ul>
            <li>Create a login controller</li>
            <li>Update the login view</li>
            <li>Add a login API rest point</li>
            <li>Add a login state to client-side routes</li>
        </ul>
    </li>
    <li>Creating a User model (mongoose and mongoDB)</li>
    <li>Adding <a href="http://passport.js" target="_blank">Passport</a> for user authentication in Express</li>
</ul>

<h3 id="installing-dependencies">Installing dependencies</h3>

<p>Run the following command to install the cookieParser and bodyParser modules</p>

<pre><code>npm install --save cookieParser bodyParser
</code></pre>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Insert in module dependencies</span>

<span class="nx">cookieParser</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">)</span>
<span class="nx">bodyParser</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">)</span>

<span class="c1">// Insert before static reference</span>

<span class="c1">// have the ability to simulate DELETE and PUT</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="c1">// have the ability to simulate DELETE and PUT</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="c1">// have the ability to parse cookies</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span></code></pre></div>

<h3>Adding the Authentication Service</h3>

<p>Update the service.js file to include a new service named 'AuthService':</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
	<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
 
	<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MyStore&#39;</span><span class="p">);</span>
 
	<span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;Auth&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$http</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$cookieStore</span><span class="p">)</span> <span class="p">{</span>
 
		<span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">$cookieStore</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
		<span class="nx">$cookieStore</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
 
		<span class="k">return</span> <span class="p">{</span>
 
			<span class="nx">login</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
 
						<span class="nx">success</span><span class="p">();</span>
					<span class="p">})</span>
					<span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
			<span class="p">},</span>
 
			<span class="nx">signup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/signup&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
			<span class="p">},</span>
 
			<span class="nx">logout</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/logout&#39;</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 
					<span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
					<span class="nx">$cookieStore</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
 
					<span class="nx">success</span><span class="p">();</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">};</span>
 
	<span class="p">});</span>
 
<span class="p">})(</span><span class="nb">window</span><span class="p">.</span><span class="nx">angular</span><span class="p">);</span></code></pre></div>

<h3>Adding the AppController</h3>

<p>In the controllers.js file, add an 'AppController' for high-level application functions, such as the logout function:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;AppController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$state</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">Auth</span><span class="p">)</span> <span class="p">{</span>
 
 
		<span class="kd">function</span> <span class="nx">successCallback</span><span class="p">()</span> <span class="p">{</span>
 
			<span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
 
			<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
				<span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;You have been logged out.&#39;</span>
			<span class="p">};</span>
 
			<span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
 
			<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">$scope</span><span class="p">.</span><span class="nx">logout</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">Auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">);</span>
		<span class="p">}</span>
 
	<span class="p">});</span></code></pre></div>

<p>Register the controller on the body tag in index.html:</p>

<pre class="prettyprint">
&lt;body ng-controller="AppController"&gt;
</pre>

<h3>Add Angular Messages</h3>

<p>As of Angular 1.3, Angular has added a messages module for simplifying form validation messages.
    Update index.html to include the CDN reference for ngMessages:</p>

<pre class="prettyprint">
&lt;script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.11/angular-messages.min.js"&gt;&lt;/script&gt;
</pre>

<p>Register the ngMessages modules in app.js as a dependencies:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
	<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
 
	<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MyStore&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ngCookies&#39;</span><span class="p">,</span> <span class="s1">&#39;ngMessages&#39;</span><span class="p">,</span> <span class="s1">&#39;ui.router&#39;</span><span class="p">]);</span>
 
<span class="p">})(</span><span class="nb">window</span><span class="p">.</span><span class="nx">angular</span><span class="p">);</span></code></pre></div>

<h3>Update the navigation</h3>

<p>While you're updating index.html, update the navigation with the logout and current user information:</p>

<pre class="prettyprint">
&lt;ul class="nav navbar-nav pull-right" ng-if="currentUser"&gt;
    &lt;li class="navbar-text" ng-bind="currentUser.email"&gt;&lt;/li&gt;
    &lt;li&gt;
        &lt;a href="javascript:void(0);" ng-click="logout()"&gt;Logout&lt;/a&gt;
    &lt;/li&gt;
&lt;/ul&gt;
</pre>

<h3>Adding the sign up</h3>

<p>Add the signup controller in the controllers.js file:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
	<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
 
	<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MyStore&#39;</span><span class="p">);</span>
 
	<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SignupController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$state</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">Auth</span><span class="p">)</span> <span class="p">{</span>
 
		<span class="kd">function</span> <span class="nx">successCallback</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
				<span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Your account has been created.&#39;</span>
			<span class="p">};</span>
 
			<span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 
				<span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
 
				<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
 
			<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
		<span class="p">}</span>
 
		<span class="kd">function</span> <span class="nx">errorCallback</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;danger&#39;</span><span class="p">,</span>
				<span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;There was an error created your account. Please try again.&#39;</span>
			<span class="p">};</span>
 
			<span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
 
			<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
		<span class="p">}</span>
 
		<span class="nx">$scope</span><span class="p">.</span><span class="nx">signup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">Auth</span><span class="p">.</span><span class="nx">signup</span><span class="p">({</span>
				<span class="nx">email</span>   <span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
				<span class="nx">password</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">password</span>
			<span class="p">},</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>
		<span class="p">};</span>
	<span class="p">});</span>
 
<span class="p">})(</span><span class="nb">window</span><span class="p">.</span><span class="nx">angular</span><span class="p">);</span></code></pre></div>

<p>Update the signup.html in the views directory:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-md-4 col-md-offset-4&quot;</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;center-form panel&quot;</span><span class="o">&gt;</span>
			<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">submit</span><span class="o">=</span><span class="s2">&quot;signup()&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;signupForm&quot;</span><span class="o">&gt;</span>
				<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
					<span class="o">&lt;</span><span class="nx">h2</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;text-center&quot;</span><span class="o">&gt;</span><span class="nx">Sign</span> <span class="nx">up</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;alert.message&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span>
					     <span class="nx">ng</span><span class="o">-</span><span class="kr">class</span><span class="o">=</span><span class="s2">&quot;{ &#39;has-success&#39; : signupForm.email.$valid &amp;&amp; signupForm.email.$dirty, &#39;has-error&#39; : signupForm.email.$invalid &amp;&amp; signupForm.email.$dirty }&quot;</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">input</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control input-lg&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;email&quot;</span>
						       <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Email&quot;</span> <span class="nx">required</span>
						       <span class="nx">autofocus</span><span class="o">&gt;</span>
 
						<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;help-block text-danger&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;signupForm.email.$dirty&quot;</span>
						     <span class="nx">ng</span><span class="o">-</span><span class="nx">messages</span><span class="o">=</span><span class="s2">&quot;signupForm.email.$error&quot;</span><span class="o">&gt;</span>
							<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;required&quot;</span><span class="o">&gt;</span><span class="nx">Your</span> <span class="nx">email</span> <span class="nx">address</span> <span class="nx">is</span> <span class="nx">required</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
							<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;email&quot;</span><span class="o">&gt;</span><span class="nx">Your</span> <span class="nx">email</span> <span class="nx">address</span> <span class="nx">is</span> <span class="nx">invalid</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
						<span class="o">&lt;</span><span class="err">/div&gt;</span>
					<span class="o">&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span>
					     <span class="nx">ng</span><span class="o">-</span><span class="kr">class</span><span class="o">=</span><span class="s2">&quot;{ &#39;has-success&#39; : signupForm.password.$valid &amp;&amp; signupForm.password.$dirty, &#39;has-error&#39; : signupForm.password.$invalid &amp;&amp; signupForm.password.$dirty }&quot;</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">input</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control input-lg&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
						       <span class="nx">ng</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span> <span class="nx">required</span><span class="o">&gt;</span>
 
						<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;help-block text-danger&quot;</span>
						     <span class="nx">ng</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;signupForm.password.$dirty&quot;</span>
						     <span class="nx">ng</span><span class="o">-</span><span class="nx">messages</span><span class="o">=</span><span class="s2">&quot;signupForm.password.$error&quot;</span><span class="o">&gt;</span>
							<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;required&quot;</span><span class="o">&gt;</span><span class="nx">Password</span> <span class="nx">is</span> <span class="nx">required</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
						<span class="o">&lt;</span><span class="err">/div&gt;</span>
					<span class="o">&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span>
					     <span class="nx">ng</span><span class="o">-</span><span class="kr">class</span><span class="o">=</span><span class="s2">&quot;{ &#39;has-success&#39; : signupForm.confirmPassword.$valid &amp;&amp; signupForm.confirmPassword.$dirty, &#39;has-error&#39; : signupForm.confirmPassword.$invalid &amp;&amp; signupForm.confirmPassword.$dirty }&quot;</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">input</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control input-lg&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
						       <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;confirmPassword&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;confirmPassword&quot;</span>
						       <span class="nx">repeat</span><span class="o">-</span><span class="nx">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Confirm Password&quot;</span>
						       <span class="nx">required</span><span class="o">&gt;</span>
 
						<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;help-block text-danger my-special-animation&quot;</span>
						     <span class="nx">ng</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;signupForm.confirmPassword.$dirty&quot;</span>
						     <span class="nx">ng</span><span class="o">-</span><span class="nx">messages</span><span class="o">=</span><span class="s2">&quot;signupForm.confirmPassword.$error&quot;</span><span class="o">&gt;</span>
							<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;required&quot;</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">must</span> <span class="nx">confirm</span> <span class="nx">password</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
							<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">message</span><span class="o">=</span><span class="s2">&quot;repeat&quot;</span><span class="o">&gt;</span><span class="nx">Passwords</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">match</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
						<span class="o">&lt;</span><span class="err">/div&gt;</span>
					<span class="o">&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">disabled</span><span class="o">=</span><span class="s2">&quot;signupForm.$invalid&quot;</span>
					        <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;btn btn-lg btn-block btn-primary&quot;</span><span class="o">&gt;</span><span class="nx">Create</span> <span class="nx">Account</span>
					<span class="o">&lt;</span><span class="err">/button&gt;</span>
				<span class="o">&lt;</span><span class="err">/div&gt;</span>
			<span class="o">&lt;</span><span class="err">/form&gt;</span>
		<span class="o">&lt;</span><span class="err">/div&gt;</span>
	<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span></code></pre></div>

<p>Update the 'signup' state in '/app/states.js' and register the controller and view above on the state.</p>

<h3>Adding the login</h3>

<p>Add the login controller to the 'controllers.js':</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
 
	<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;MyStore&#39;</span><span class="p">);</span>
 
	<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;LoginController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$state</span><span class="p">,</span> <span class="nx">$timeout</span><span class="p">,</span> <span class="nx">Auth</span><span class="p">)</span> <span class="p">{</span>
 
		<span class="kd">function</span> <span class="nx">successCallback</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
				<span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;You have successfully logged in.&#39;</span>
			<span class="p">};</span>
 
			<span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 
				<span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">);</span>
 
				<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
 
			<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
		<span class="p">}</span>
 
		<span class="kd">function</span> <span class="nx">errorCallback</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;danger&#39;</span><span class="p">,</span>
				<span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Invalid username and/or password&#39;</span>
			<span class="p">};</span>
 
			<span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">$scope</span><span class="p">.</span><span class="nx">alert</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
 
			<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
		<span class="p">}</span>
 
		<span class="nx">$scope</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 
			<span class="nx">Auth</span><span class="p">.</span><span class="nx">login</span><span class="p">({</span>
				<span class="nx">email</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
				<span class="nx">password</span><span class="o">:</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">password</span>
			<span class="p">},</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>
 
		<span class="p">};</span>
 
	<span class="p">});</span>
 
<span class="p">})(</span><span class="nb">window</span><span class="p">.</span><span class="nx">angular</span><span class="p">);</span></code></pre></div>

<p>Update login.html in the views directory:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;col-md-4 col-md-offset-4&quot;</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;center-form panel&quot;</span><span class="o">&gt;</span>
			<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;panel-body&quot;</span><span class="o">&gt;</span>
				<span class="o">&lt;</span><span class="nx">h2</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;text-center&quot;</span><span class="o">&gt;</span><span class="nx">Login</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
 
				<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;alert alert-&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">bind</span><span class="o">=</span><span class="s2">&quot;alert.message&quot;</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
 
				<span class="o">&lt;</span><span class="nx">form</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">submit</span><span class="o">=</span><span class="s2">&quot;login()&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;loginForm&quot;</span><span class="o">&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">input</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control input-lg&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span>
						       <span class="nx">ng</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Email&quot;</span> <span class="nx">required</span> <span class="nx">autofocus</span><span class="o">&gt;</span>
					<span class="o">&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
						<span class="o">&lt;</span><span class="nx">input</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;form-control input-lg&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
						       <span class="nx">ng</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span> <span class="nx">required</span><span class="o">&gt;</span>
					<span class="o">&lt;</span><span class="err">/div&gt;</span>
 
					<span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">disabled</span><span class="o">=</span><span class="s2">&quot;loginForm.$invalid&quot;</span>
					        <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;btn btn-lg btn-block btn-success&quot;</span><span class="o">&gt;</span><span class="nx">Sign</span> <span class="nx">In</span>
					<span class="o">&lt;</span><span class="err">/button&gt;</span>
				<span class="o">&lt;</span><span class="err">/form&gt;</span>
			<span class="o">&lt;</span><span class="err">/div&gt;</span>
		<span class="o">&lt;</span><span class="err">/div&gt;</span>
	<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span></code></pre></div>

<p>Update the 'login' state in '/app/states.js' and register the controller and view above on the state.</p>

<h3>Add the User model</h3>
<h3>Add the User model</h3>

<p>Create a new file named User.js in the '/models' directory:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Require mongoose dependency</span>
<span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bcrypt-nodejs&#39;</span><span class="p">);</span>
 
<span class="kd">var</span> <span class="nx">userSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
	<span class="nx">email</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">unique</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
	<span class="nx">password</span><span class="o">:</span> <span class="nb">String</span>
<span class="p">});</span>
 
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="nx">userSchema</span><span class="p">);</span>
 
<span class="nx">userSchema</span><span class="p">.</span><span class="nx">pre</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isModified</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">))</span> <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
	<span class="nx">bcrypt</span><span class="p">.</span><span class="nx">genSalt</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">salt</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
		<span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
			<span class="nx">user</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">;</span>
			<span class="nx">next</span><span class="p">();</span>
		<span class="p">});</span>
	<span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3>Add API routes</h3>

<p>Add the login and logout API routes to '/routes.js', including the dependency to passport:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Add the dependency to passport after the mongoose require declaration</span>
	<span class="kd">var</span> <span class="nx">passport</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport&#39;</span><span class="p">);</span>
 
<span class="c1">// Add the following routes after the products routes</span>
<span class="c1">// logout API route</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/logout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">req</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
	<span class="p">});</span>
 
	<span class="c1">// login API route</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/login&#39;</span><span class="p">,</span> <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">));</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
	<span class="p">});</span>
 
	<span class="c1">// signup API route</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/signup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span>
			<span class="nx">email</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
			<span class="nx">password</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span>
		<span class="p">});</span>
		<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
			<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">});</span></code></pre></div>

<h3>Add Node.js Dependencies</h3>

<p>In the terminal or console, change directories (cd) to the root of the MyStore app and run the following command:</p>
<pre class="prettyprint">
npm install --save express-session passport passport-local bcrypt-nodejs
</pre>

<h3>Add Passport</h3>

<p>Update the server.js file to include the dependencies from above and to configure them:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Add the following to the dependencies (after bodyParser)</span>
 
<span class="kd">var</span> <span class="nx">passport</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">session</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express-session&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">LocalStrategy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;passport-local&#39;</span><span class="p">).</span><span class="nx">Strategy</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bcrypt</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bcrypt-nodejs&#39;</span><span class="p">);</span>
 
<span class="c1">// Add the following after the MODELS</span>
 
<span class="c1">// ===================== PASSPORT ========================= /</span>
<span class="nx">passport</span><span class="p">.</span><span class="nx">serializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
 
<span class="nx">passport</span><span class="p">.</span><span class="nx">deserializeUser</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
 
	<span class="nx">User</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">});</span>
 
<span class="nx">passport</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">new</span> <span class="nx">LocalStrategy</span><span class="p">({</span> <span class="nx">usernameField</span><span class="o">:</span> <span class="s1">&#39;email&#39;</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">);</span>
 
	<span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">email</span><span class="o">:</span> <span class="nx">email</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
 
		<span class="kd">function</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">isMatch</span><span class="p">)</span> <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
			<span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
			<span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">isMatch</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">});</span>
<span class="p">}));</span>
 
<span class="c1">// Add the following after express.static in module section</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span> <span class="nx">secret</span><span class="o">:</span> <span class="s1">&#39;blackwidow straw&#39;</span> <span class="p">}));</span>                       <span class="c1">// Encryption key/salt</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">initialize</span><span class="p">());</span>                                         <span class="c1">// Initializes passport</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">passport</span><span class="p">.</span><span class="nx">session</span><span class="p">());</span>                                            <span class="c1">// Creates a passport session</span>
 
<span class="c1">// Add the following after express.static</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="nx">next</span><span class="p">();</span>
<span class="p">});</span></code></pre></div>

<div class="alert alert-info">
    <p>Remember to commit your changes to Github!</p>
</div>


    </section>

    <div id="disqus_thread" class="comments"></div>
</div>

<div class="col col-sm-3">
    <div id="sidebar" class="sidebar">

        <h3>Schedule</h3>
        <ul class="nav nav-list">
            
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/">Course overview</a></li>
        
    
        
    
        
    

    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-1-javascript-objects/">Day 1 - JavaScript Objects</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-2-intro-to-angularjs/">Day 2 - Intro to AngularJS</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-3-get-your-swag-on/">Day 3 - Get your swagger on!</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-4-product-listing/">Day 4 - Product Listing</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-5-getting-mean/">Day 5 - Getting MEAN</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-6-directives/">Day 6 - Directives</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-7-shopping-cart-part-1/">Day 7 - Shopping Cart Part 1</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-8-shopping-cart-part-2/">Day 8 - Shopping Cart Part 2</a></li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <li><a href="/geekwise/day-9-user-authentication/">Day 9 - User Authentication</a></li>
        
    
        
    
        
    
        
    
        
    
        
    

        </ul>

    </div>
</div>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pixelpolished'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

        </div>
    </div>

    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <h3>Aaron Roberson</h3>
                <p class="text-muted">&copy; 2014 Aaron Roberson. All rights reserved.</p>
                <a class="btn btn-linkedin" href="https://linkedin.com/in/aaronrobes" title="LinkedIn">
                    <i class="fa fa-linkedin"></i>
                </a>
                <a class="btn btn-google-plus" href="" title="Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
                <a class="btn btn-twitter" href="https://twitter.com/aaronroberson" title="Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="btn btn-github" href="https://github.com/aaronroberson" title="GitHub">
                    <i class="fa fa-github"></i>
                </a>
            </div>
            <div class="col-sm-4">
                <h3>Posts <a href="/feed.xml" class="pull-right" target="_blank"><i class="fa fa-rss"></i></a></h3>

<ul class="nav nav-stacked">
    
    <li>
        <a href="/angularjs/2014/08/28/testing-fouc-angularjs-mac/">
            Testing FOUC with AngularJS (Mac)
            <small class="text-muted pull-right">Aug 28, 2014</small>
        </a>
    </li>
    
    <li>
        <a href="/geekwise/2014/07/18/javascript-2-with-angularjs/">
            Geekwise Academy: JavaScript II with AngularJS
            <small class="text-muted pull-right">Jul 18, 2014</small>
        </a>
    </li>
    
</ul>
            </div>
            <div class="col-sm-4">
                <h3>Mailing list</h3>
                <div id="mc_embed_signup">
                    <form action="http://pixelpolished.us8.list-manage1.com/subscribe/post?u=429c146ae2114b333686e6374&amp;id=990bceac24" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control input-sm" name="FNAME" id="mce-FNAME" placeholder="First name" required="required" />
                                        <span class="input-group-addon"><span class="fa fa-user"></span></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control input-sm" name="LNAME" id="mce-LNAME" placeholder="Last name" required="required" />
                                        <span class="input-group-addon"><span class="fa fa-user"></span> </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="email" class="form-control input-sm" name="EMAIL" id="mce-EMAIL" placeholder="Email address" required="required" />
                                        <span class="input-group-addon"><span class="fa fa-envelope"></span></span>
                                    </div>
                                </div>
                                <div id="mce-responses" class="clear">
                                    <div class="response" id="mce-error-response" style="display:none"></div>
                                    <div class="response" id="mce-success-response" style="display:none"></div>
                                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                                <div style="position: absolute; left: -5000px;">
                                    <input type="text" name="b_429c146ae2114b333686e6374_990bceac24" value="">
                                </div>
                                <div class="clear">
                                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn btn-default btn-sm pull-right">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</footer>


    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            $('#sidebar').affix({
                offset: {
                    top: 180,
                    bottom: function () {
                        return (this.bottom = $('.footer').outerHeight(true))
                    }
                }
            });
        });
        window.analytics=window.analytics||[],window.analytics.methods=["identify","group","track","page","pageview","alias","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(t){if(!document.getElementById("analytics-js")){var a=document.createElement("script");a.type="text/javascript",a.id="analytics-js",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.io/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},window.analytics.SNIPPET_VERSION="2.0.9",
                window.analytics.load("kqe985dobm");
        window.analytics.page();
    </script>
    </body>
</html>